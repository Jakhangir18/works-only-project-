---
// RocketStorySection.astro
// Tall spacer section that drives the scroll progress for rocket + text overlays.
// Height: 800vh to allow for cinematic, slow animations.
// No visible content; just provides scroll range.
---

<section class="rocket-story js-rocket-story" aria-label="Rocket story">
  <!-- Spacer: 800vh tall, drives scroll progress -->
</section>

<style lang="scss">
  .rocket-story {
    position: relative;
    height: 900vh;
    background: transparent;
    z-index: 0;
    pointer-events: none;
  }
</style>

<script>
  /**
   * RocketStorySection scroll handler.
   * Calculates progress (0..1) and updates rocket frame + text slides.
   */
  (function initRocketStory() {
    const section = document.querySelector('.js-rocket-story') as HTMLElement
    if (!section) return

    function update() {
      // Calculate scroll progress relative to this section
      const rect = section.getBoundingClientRect()
      const sectionStart = rect.top
      const sectionHeight = section.offsetHeight
      const windowHeight = window.innerHeight

      // Progress: 0 when section top is at window bottom, 1 when section bottom exits window top
      let rawProgress = (windowHeight - sectionStart) / (sectionHeight + windowHeight)
      rawProgress = Math.max(0, Math.min(1, rawProgress))
      
      // Add delay at the start - first 12% is hold time
      const DELAY = 0.12
      let progress = 0
      if (rawProgress < DELAY) {
        progress = 0
      } else {
        progress = (rawProgress - DELAY) / (1 - DELAY)
      }

      // Update rocket frame
      if (typeof window.updateRocketFrame === 'function') {
        window.updateRocketFrame(progress)
      }

      // Update rocket rotation + position via GSAP timeline
      if (typeof window.updateRocketMotion === 'function') {
        window.updateRocketMotion(progress)
      }

      // Update text slides
      if (typeof window.updateTextSlides === 'function') {
        window.updateTextSlides(progress)
      }
    }

    window.addEventListener('scroll', update, { passive: true })
    window.addEventListener('resize', update, { passive: true })

    // Initial call
    requestAnimationFrame(update)
  })()
</script>
