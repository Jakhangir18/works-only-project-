class m{root;canvas;ctx;totalFrames;startFrame;framePath;frameExt;frameCache;pendingLoads;currentFrame;rafId;constructor(t){this.root=t,this.canvas=t.querySelector(".hero-sequence__canvas"),this.ctx=this.canvas.getContext("2d"),this.totalFrames=Number(t.dataset.totalFrames||120),this.startFrame=Number(t.dataset.startFrame||1),this.framePath=t.dataset.framePath||"/hero-sequence/frame_",this.frameExt=t.dataset.frameExt||"jpg",this.frameCache=new Map,this.pendingLoads=new Map,this.currentFrame=this.startFrame,this.rafId=0,this.onResize=this.onResize.bind(this),this.onScroll=this.onScroll.bind(this),this.render=this.render.bind(this)}init(){this.resizeCanvas(),this.preload(this.startFrame)?.then(e=>this.drawCover(e)).catch(()=>{}),this.preloadBatch(this.startFrame,Math.min(this.startFrame+24,this.endFrame())),window.addEventListener("resize",this.onResize,{passive:!0}),window.addEventListener("scroll",this.onScroll,{passive:!0}),this.render();const t=()=>{this.preloadBatch(this.startFrame,this.endFrame())};"requestIdleCallback"in window?window.requestIdleCallback(t):setTimeout(t,400)}endFrame(){return this.startFrame+this.totalFrames-1}frameUrl(t){const e=String(t).padStart(3,"0");return`${this.framePath}${e}.${this.frameExt}`}preload(t){if(this.frameCache.has(t))return Promise.resolve(this.frameCache.get(t));if(this.pendingLoads.has(t))return this.pendingLoads.get(t);const e=new Promise((s,a)=>{const r=new Image;r.decoding="async",r.src=this.frameUrl(t),r.onload=()=>{this.frameCache.set(t,r),this.pendingLoads.delete(t),s(r)},r.onerror=()=>{this.pendingLoads.delete(t),a(new Error(`Frame load failed: ${t}`))}});return this.pendingLoads.set(t,e),e}preloadBatch(t,e){for(let s=t;s<=e;s++)this.preload(s)?.catch(()=>{})}resizeCanvas(){const t=Math.max(1,window.devicePixelRatio||1),e=window.innerWidth,s=window.innerHeight;this.canvas.width=Math.floor(e*t),this.canvas.height=Math.floor(s*t),this.canvas.style.width=`${e}px`,this.canvas.style.height=`${s}px`,this.ctx.setTransform(t,0,0,t,0,0),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high"}getProgress(){const t=this.root.getBoundingClientRect(),e=window.scrollY+t.top,s=Math.max(1,t.height-window.innerHeight),a=(window.scrollY-e)/s;return Math.min(1,Math.max(0,a))}frameByProgress(t){const e=Math.round(t*(this.totalFrames-1));return this.startFrame+e}drawCover(t){const e=window.innerWidth,s=window.innerHeight,a=t.naturalWidth||t.width,r=t.naturalHeight||t.height;if(!a||!r)return;const n=Math.max(e/a,s/r),h=a*n,o=r*n,c=(e-h)*.5,l=(s-o)*.5;this.ctx.clearRect(0,0,e,s),this.ctx.drawImage(t,c,l,h,o)}render(){this.rafId=0;const t=this.getProgress(),e=this.frameByProgress(t);if(e===this.currentFrame&&this.frameCache.has(e)){const s=this.frameCache.get(e);s&&this.drawCover(s);return}this.currentFrame=e,this.preload(e)?.then(s=>{this.currentFrame===e&&this.drawCover(s)}).catch(()=>{}),this.preloadBatch(Math.max(this.startFrame,e-2),Math.min(this.endFrame(),e+2))}requestRender(){this.rafId||(this.rafId=window.requestAnimationFrame(this.render))}onResize(){this.resizeCanvas(),this.requestRender()}onScroll(){this.requestRender()}}const d=()=>{const i=document.querySelector("[data-hero-sequence]");if(!i)return;new m(i).init()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d,{once:!0}):d();
